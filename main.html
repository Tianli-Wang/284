<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»¿çœŸç³»ç»Ÿç•Œé¢ - å«æ˜Ÿæ˜Ÿåº§</title>
  <style>
    /* --- åŸºç¡€å’Œå…¨å±€æ ·å¼ --- */
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

    :root {
      --bg-color: #f0f2f5;
      /* æ›´æŸ”å’Œçš„èƒŒæ™¯ç° */
      --panel-bg-color: #ffffff;
      --border-color: #e0e0e0;
      --text-color: #333;
      --text-secondary-color: #666;
      --accent-color: #1a73e8;
      /* ç±»ä¼¼ Google/NotebookLM è“ */
      --danger-color: #d93025;
      --success-color: #188038;
    }

    body {
      font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-size: 14px;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    .app-header {
      background-color: #fff;
      padding: 10px 20px;
      border-bottom: 1px solid var(--border-color);
      font-size: 16px;
      font-weight: bold;
      color: var(--text-color);
    }

    /* --- ä¸»å†…å®¹åŒºï¼š3æ 2è¡Œ Grid å¸ƒå±€ --- */
    .main-content {
      flex-grow: 1;
      display: grid;
      /* å·¦(320px) ä¸­(è‡ªåŠ¨å¡«å……) å³(320px) */
      grid-template-columns: 320px 1fr 320px;
      /* ç¬¬1è¡Œ(55%): å·¦å³é¡¶éƒ¨é¢æ¿é«˜åº¦ */
      /* ç¬¬2è¡Œ(15%): ä¸­é—´å¤§å›¾æ¯”å·¦å³é¡¶éƒ¨å¤šå‡ºæ¥çš„é«˜åº¦ */
      /* ç¬¬3è¡Œ(auto): ä¸­é—´åº•éƒ¨é¢æ¿çš„é«˜åº¦ (å‰©ä½™ç©ºé—´) */
      grid-template-rows: 55% 15% 1fr;
      gap: 16px;
      padding: 16px;
      overflow: hidden;
      position: relative;
    }

    /* --- é¢æ¿é€šç”¨æ ·å¼ (ä»¿ NotebookLM å¡ç‰‡) --- */
    .panel {
      background-color: var(--panel-bg-color);
      border-radius: 12px;
      /* æ›´å¤§çš„åœ†è§’ */
      border: 1px solid var(--border-color);
      /* è½»å¾®è¾¹æ¡† */
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      /* æŸ”å’Œé˜´å½± */
      padding: 16px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .panel h2 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 15px;
      color: var(--text-secondary-color);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid #f0f0f0;
      padding-bottom: 8px;
      display: flex;
      justify-content: space-between;
    }

    .panel-content {
      overflow-y: auto;
      flex-grow: 1;
      position: relative;
      /* ä¸ºå†…éƒ¨ç»å¯¹å®šä½å…ƒç´ åšå‚è€ƒ */
    }

    /* --- Grid åŒºåŸŸé‡æ–°åˆ†é… (å®ç°é”™è½å¸ƒå±€) --- */

    /* 1. å·¦ä¸Šï¼šçŠ¶æ€ç›‘æ§ (åªå ç¬¬1è¡Œ) */
    #status-monitor {
      grid-area: 1 / 1 / 2 / 2;
    }

    /* 2. å·¦ä¸‹ï¼šå‚æ•°è¾“å…¥ (è·¨è¶Šç¬¬2ã€3è¡Œ -> å˜é«˜äº†) */
    #input-area {
      grid-area: 2 / 1 / 4 / 2;
    }

    /* 3. ä¸­ä¸Šï¼šä»¿çœŸè§†å›¾ (è·¨è¶Šç¬¬1ã€2è¡Œ -> å˜é«˜äº†ï¼Œä¸ºäº†å±•ç¤ºåœ°çƒ) */
    #scene-display {
      grid-area: 1 / 2 / 3 / 3;
    }

    /* 4. ä¸­ä¸‹ï¼šé“¾è·¯çŠ¶æ€ (åªå ç¬¬3è¡Œ -> å˜çŸ®äº†ï¼Œåªç•™ç»™æ—¥å¿—å’Œæ—¶é—´è½´) */
    #result-output {
      grid-area: 3 / 2 / 4 / 3;
    }

    /* 5. å³ä¸Šï¼šåŠŸèƒ½æ§åˆ¶ (åªå ç¬¬1è¡Œ) */
    #function-control {
      grid-area: 1 / 3 / 2 / 4;
    }

    /* 6. å³ä¸‹ï¼šä»¿çœŸæŠ¥å‘Š (è·¨è¶Šç¬¬2ã€3è¡Œ -> å˜é«˜äº†) */
    #report-output {
      grid-area: 2 / 3 / 4 / 4;
    }

    /* --- 1. å·¦ä¸Šï¼šçŠ¶æ€ç›‘æ§ --- */
    .status-list li {
      margin-bottom: 8px;
      font-size: 13px;
    }

    .progress-bar-container {
      width: 50%;
    }

    /* --- æ–°å¢ï¼šæµç¨‹å›¾æ ·å¼ --- */
    .process-flow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 20px;
      margin-bottom: 20px;
      padding: 0 2px;
    }

    .process-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .step-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: #f8f9fa;
      border: 2px solid #ccc;
      color: #999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
      transition: all 0.3s;
      margin-bottom: 0;
    }

    .process-step.active .step-circle {
      background-color: var(--accent-color);
      border-color: var(--accent-color);
      color: white;
      box-shadow: 0 0 8px rgba(26, 115, 232, 0.4);
    }

    .step-line {
      flex-grow: 1;
      height: 2px;
      background-color: #e0e0e0;
      margin: 0 4px;
      position: relative;
    }

    /* ç®­å¤´æ ·å¼ */
    .step-line::after {
      content: '';
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
      border-left: 5px solid #e0e0e0;
    }

    /* --- 2. å·¦ä¸‹ï¼šè¾“å…¥æ  --- */
    #input-container {
      position: relative;
      height: 100%;
    }

    .placeholder-text {
      color: #999;
      text-align: center;
      margin-top: 40px;
      font-style: italic;
    }

    /* --- å¼¹çª—é®ç½©å±‚ --- */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    /* æ˜¾ç¤ºé®ç½©å±‚ */
    .modal-overlay.visible {
      display: flex;
    }

    /* --- å¼¹çª—æ ·å¼ --- */
    .secondary-panel {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      width: 80% !important;
      max-width: 600px !important;
      height: auto !important;
      max-height: 80vh !important;
      background-color: var(--panel-bg-color);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1001;
      display: none !important;
      flex-direction: column;
      overflow: hidden;
    }

    /* åªæœ‰å¸¦æœ‰ visible ç±»çš„é¢æ¿æ‰æ˜¾ç¤º */
    .secondary-panel.visible {
      display: flex !important;
    }

    /* å¼¹çª—å¤´éƒ¨æ ·å¼ */
    .secondary-panel-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f8f9fa;
    }

    .secondary-panel-header h2 {
      font-size: 16px;
      margin: 0;
      color: var(--text-color);
      font-weight: 600;
    }

    .secondary-panel-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .secondary-panel-close:hover {
      background-color: #e0e0e0;
      color: #333;
    }

    /* å¼¹çª—ä¸»ä½“æ ·å¼ */
    .secondary-panel-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
      max-height: calc(80vh - 140px);
    }

    /* è¡¨å•æ ·å¼ */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: inherit;
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    /* å¼¹çª—åº•éƒ¨æ ·å¼ */
    .secondary-panel-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      background-color: #f8f9fa;
    }

    .secondary-panel-footer button {
      padding: 8px 16px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .secondary-panel-footer .btn-save {
      background-color: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }

    .secondary-panel-footer .btn-save:hover {
      background-color: #1557b0;
    }

    .secondary-panel-footer .btn-cancel:hover {
      background-color: #f1f3f4;
    }

    /* --- 3. ä¸­ä¸Šï¼šä»¿çœŸè§†å›¾ --- */
    .viz-placeholder {
      background-color: #000;
      /* å¤ªç©ºé»‘èƒŒæ™¯ */
      border-radius: 8px;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #555;
      overflow: hidden;
      position: relative;
    }

    .scene-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.8;
    }

    /* --- 4. ä¸­ä¸‹ï¼šè¾“å‡ºä¿¡æ¯ --- */
    #link-list-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      /* å¡ç‰‡å¼å¸ƒå±€ */
      gap: 10px;
    }

    .link-status {
      margin-bottom: 0;
      font-size: 12px;
    }

    .filter-controls {
      font-size: 12px;
    }

    /* --- æ—¶é—´è½´æ§åˆ¶æ ·å¼ --- */
    .timeline-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 0 10px 0;
      border-bottom: 1px solid #f0f0f0;
      margin-bottom: 0;
      /* ç´§è´´ä¸‹æ–¹å†…å®¹ */
      flex-shrink: 0;
      /* é˜²æ­¢è¢«å‹ç¼© */
    }

    .timeline-bar input[type="range"] {
      flex-grow: 1;
      cursor: pointer;
    }

    .time-mark {
      font-size: 11px;
      color: #888;
      font-family: monospace;
    }

    /* --- åªè¯»æ–‡æœ¬æ¡†æ ·å¼ (ä»¿ç»ˆç«¯) --- */
    .terminal-output {
      width: 100%;
      height: 100%;
      border: none;
      resize: none;
      /* ç¦æ­¢ç”¨æˆ·æ‹–åŠ¨å¤§å° */
      background-color: #fafafa;
      color: #333;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.5;
      padding: 10px 15px;
      box-sizing: border-box;
      outline: none;
      /* ç§»é™¤èšç„¦è¾¹æ¡† */
      white-space: pre-wrap;
      /* ä¿æŒæ¢è¡Œ */
    }

    /* æ»šåŠ¨æ¡ç¾åŒ– (å¯é€‰) */
    .terminal-output::-webkit-scrollbar {
      width: 6px;
    }

    .terminal-output::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 3px;
    }

    /* --- 5. å³ä¸Šï¼šåŠŸèƒ½æ§åˆ¶ --- */
    .control-group {
      margin-bottom: 20px;
    }

    .control-group h3 {
      font-size: 12px;
      color: #999;
      margin: 0 0 10px 0;
      font-weight: normal;
    }

    /* æŒ‰é’®ç½‘æ ¼ */
    .button-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .btn-tool {
      padding: 8px;
      border: 1px solid var(--border-color);
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      text-align: center;
    }

    .btn-tool:hover {
      background-color: #f1f3f4;
    }

    .btn-primary {
      background-color: var(--accent-color);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background-color: #1557b0;
    }

    .btn-danger {
      color: var(--danger-color);
      border-color: #fce8e6;
    }

    .btn-danger:hover {
      background-color: #fce8e6;
    }

    /* æ¨¡å—åˆ—è¡¨ */
    .module-grid {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .btn-module {
      background: transparent;
      border: 1px solid transparent;
      text-align: left;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .btn-module:hover {
      background-color: #e8f0fe;
      color: var(--accent-color);
    }

    /* æ¨¡æ‹Ÿé€‰ä¸­çŠ¶æ€ - éœ€è¦JSé…åˆï¼Œè¿™é‡Œä»…ä½œæ ·å¼ */
    .btn-module:active {
      background-color: #d2e3fc;
    }

    /* --- çŠ¶æ€æŒ‡ç¤ºç¯æ ·å¼ --- */
    .status-icon {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #d93025;
      /* é»˜è®¤çº¢è‰² */
      margin-right: 10px;
      flex-shrink: 0;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    .btn-module.confirmed .status-icon {
      background-color: #188038;
      /* ç¡®è®¤åå˜ç»¿ */
      box-shadow: 0 0 5px #188038;
    }

    /* è¿è¡ŒæŒ‰é’®ç¦ç”¨çŠ¶æ€ */
    #sim-start-btn:disabled {
      background-color: #e0e0e0;
      color: #999;
      cursor: not-allowed;
      border-color: #ccc;
    }

    /* --- 6. å³ä¸‹ï¼šæŠ¥å‘ŠåŒº --- */
    .report-content {
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
      color: #444;
    }

    .log-entry {
      margin: 4px 0;
      border-bottom: 1px dashed #eee;
      padding-bottom: 4px;
    }

    .log-entry .time {
      color: #888;
      margin-right: 5px;
    }

    .log-entry.warning {
      color: #d93025;
    }

    /* --- çŠ¶æ€æ  --- */
    .status-bar {
      background-color: #fff;
      color: #555;
      border-top: 1px solid var(--border-color);
      font-size: 12px;
      padding: 5px 20px;
      display: flex;
      justify-content: space-between;
    }

    .status-bar-right {
      display: flex;
      gap: 15px;
    }

    /* å“åº”å¼é€‚é… */
    @media (max-width: 1200px) {
      .main-content {
        grid-template-columns: 250px 1fr 250px;
      }
    }
  </style>
</head>



<!-- TODOï¼š
  æ·»åŠ åŒæ–¹çŠ¶æ€æœºï¼Œ
  ç‚¹å‡»æŸ¥è¯¢è¯¦ç»†æƒ…å†µï¼Œ
  äº‹ä»¶è·³è½¬ -->





<body>

<div class="app-container">

  <header class="app-header">
    <div class="logo">ğŸ›°ï¸ å«æ˜Ÿæ˜Ÿåº§ä»¿çœŸç³»ç»Ÿ</div>
  </header>

  <main class="main-content">

    <section class="panel" id="status-monitor">
      <h2>ä»¿çœŸçŠ¶æ€</h2>
      <div class="panel-content">
        <!-- <div id="simulation-time" class="metric-item" style="text-align: center; margin-bottom: 15px;"> -->
          <!-- <div class="label" style="display:inline-block; margin-right: 5px;">ä»¿çœŸè¿è¡Œæ—¶é—´:</div>
          <div class="value" style="color: var(--accent-color); font-weight: bold;"><span>0.0</span> s</div> -->
        <!-- </div> -->
        <div class="control-group" style="text-align: center;">
          <h3>å½“å‰é˜¶æ®µ</h3>
          <div class="btn-tool" style="margin-bottom: 15px;">æ ‡æ ¡ä¸­</div>
        </div>

        <!-- æµç¨‹å›¾ç»„ä»¶ -->
        <div class="process-flow">
          <div class="process-step active">
            <div class="step-circle">æ ‡æ ¡</div>
          </div>
          <div class="step-line"></div>
          <div class="process-step">
            <div class="step-circle">æ•è·</div>
          </div>
          <div class="step-line"></div>
          <div class="process-step">
            <div class="step-circle">è·Ÿè¸ª</div>
          </div>
          <div class="step-line"></div>
          <div class="process-step">
            <div class="step-circle">é€šä¿¡</div>
          </div>
        </div>

        <div class="control-group" style="margin-top: 10px; padding: 0 5px;">
          <div class="button-grid">
            <button class="btn-tool btn-primary" id="btn-mode-auto" onclick="setRunMode('auto')">âš¡ è‡ªåŠ¨è¿è¡Œ</button>
            <button class="btn-tool" id="btn-mode-step" onclick="setRunMode('step')">ğŸ‘£ å•é˜¶æ®µè¿è¡Œ</button>
          </div>
        </div>
        

      </div>
      <h2>ç³»ç»Ÿèµ„æº</h2>
      <ul class="status-list">
        <li><strong>ä»¿çœŸçŠ¶æ€:</strong> <span class="value running" style="color:green">è¿è¡Œä¸­</span></li>
        <!-- <li><strong>å½“å‰æ—¶åˆ»:</strong> <span class="value">2025-10-30 2:30:45</span></li> -->
        <li><strong>ä»¿çœŸè¿›åº¦:</strong>
          <div class="progress-bar-container" style="display:inline-block; width: 60px; vertical-align:middle;">
            <progress value="75" max="100" style="width:100%"></progress>
          </div>
          <span class="value">75%</span>
        </li>
        <li><strong>CPUä½¿ç”¨:</strong> <span class="value">76%</span></li>
        <li><strong>å†…å­˜ä½¿ç”¨:</strong> <span class="value">113 / 512 GB</span></li>
        <li><strong>æ´»åŠ¨é“¾è·¯:</strong> <span class="value">567 / 700</span></li>
      </ul>
    </section>

    <section class="panel" id="input-area">
      <h2>å‚æ•°è¾“å…¥ (éœ€å…¨éƒ¨å®Œæˆ)</h2>

      <div class="control-group">
        <div class="module-grid">
          <button class="param-item btn-module" data-panel-target="panel-environment-params">
            <span class="status-icon"></span> 1ï¸âƒ£ ç¯å¢ƒå‚æ•°è¾“å…¥
          </button>
          <button class="param-item btn-module" data-panel-target="panel-orbit-params">
            <span class="status-icon"></span> 2ï¸âƒ£ è½¨é“å‚æ•°è¾“å…¥
          </button>
          <button class="param-item btn-module" data-panel-target="panel-terminal-params">
            <span class="status-icon"></span> 3ï¸âƒ£ ç»ˆç«¯å‚æ•°è¾“å…¥
          </button>
          <button class="param-item btn-module" data-panel-target="panel-device-params">
            <span class="status-icon"></span> 4ï¸âƒ£ å™¨ä»¶å‚æ•°è¾“å…¥
          </button>
          <button class="param-item btn-module" data-panel-target="panel-task-params">
            <span class="status-icon"></span> 5ï¸âƒ£ ä»»åŠ¡å‚æ•°è¾“å…¥
          </button>
        </div>
      </div>

      <!-- å¼¹çª—ç»„ä»¶å®¹å™¨ -->
      <div id="component-panels-container">

        <!-- 1. ç¯å¢ƒå‚æ•°è¾“å…¥é¢æ¿ -->
        <div id="panel-environment-params" class="secondary-panel">
          <div class="secondary-panel-header">
            <h2>ç¯å¢ƒå‚æ•°é…ç½®</h2>
            <button class="secondary-panel-close">Ã—</button>
          </div>
          <div class="secondary-panel-body">
            <div class="form-group">
              <label>ç©ºé—´ç¯å¢ƒæ¨¡å‹</label>
              <select>
                <option>æ¸©åº¦</option>
                <option>è¾ç…§</option>
                <option>è‡ªç”±ç©ºé—´æŸè€—</option>
                <option>To be added ...</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>balabala </label>
                <input type="number" value="25.4">
              </div>
              <div class="form-group">
                <label>balabala</label>
                <input type="number" value="290">
              </div>
            </div>

            <div class="form-group">
              <label>å¤ªé˜³æ´»åŠ¨æŒ‡æ•° (F10.7)</label>
              <input type="range" min="50" max="300" value="150" style="width:100%">
              <div style="display:flex; justify-content:space-between; font-size:12px; color:#888;">
                <span>Low (50)</span>
                <span>High (300)</span>
              </div>
            </div>

            <div class="form-group">
              <label>èƒŒæ™¯å™ªå£°æ¸©åº¦</label>
              <input type="number" value="2.7">
            </div>
          </div>
          <div class="secondary-panel-footer">
            <button class="btn-cancel">å–æ¶ˆ</button>
            <button class="btn-save">ç¡®è®¤ä¿å­˜</button>
          </div>
        </div>

        <!-- 2. è½¨é“å‚æ•°é¢æ¿ -->
        <div id="panel-orbit-params" class="secondary-panel">
          <div class="secondary-panel-header">
            <h2>è½¨é“å‚æ•°é…ç½®</h2>
            <button class="secondary-panel-close">Ã—</button>
          </div>
          <div class="secondary-panel-body">
            <div class="form-group"><label>æ˜Ÿåº§ç±»å‹</label><select>
              <option>Walker Delta</option>
              <option>Walker Star</option>
            </select></div>
            <div class="form-group"><label>è½¨é“é«˜åº¦ (km)</label><input type="number" value="550"></div>
          </div>
          <div class="secondary-panel-footer">
            <button class="btn-cancel">å–æ¶ˆ</button>
            <button class="btn-save">ç¡®è®¤ä¿å­˜</button>
          </div>
        </div>

        <!-- 3. ç»ˆç«¯å‚æ•°é¢æ¿ -->
        <div id="panel-terminal-params" class="secondary-panel">
          <div class="secondary-panel-header">
            <h2>ç»ˆç«¯å‚æ•°é…ç½®</h2><button class="secondary-panel-close">Ã—</button>
          </div>
          <div class="secondary-panel-body">
            <p>ç»ˆç«¯å‚æ•°é…ç½®å†…å®¹...</p>
          </div>
          <div class="secondary-panel-footer"><button class="btn-cancel">å–æ¶ˆ</button><button class="btn-save">ç¡®è®¤ä¿å­˜</button></div>
        </div>

        <!-- 4. å™¨ä»¶å‚æ•°é¢æ¿ -->
        <div id="panel-device-params" class="secondary-panel">
          <div class="secondary-panel-header">
            <h2>å™¨ä»¶å‚æ•°é…ç½®</h2><button class="secondary-panel-close">Ã—</button>
          </div>
          <div class="secondary-panel-body">
            <p>å™¨ä»¶å‚æ•°é…ç½®å†…å®¹...</p>
          </div>
          <div class="secondary-panel-footer"><button class="btn-cancel">å–æ¶ˆ</button><button class="btn-save">ç¡®è®¤ä¿å­˜</button></div>
        </div>

        <!-- 5. ä»»åŠ¡å‚æ•°é¢æ¿ -->
        <div id="panel-task-params" class="secondary-panel">
          <div class="secondary-panel-header">
            <h2>ä»»åŠ¡å‚æ•°é…ç½®</h2><button class="secondary-panel-close">Ã—</button>
          </div>
          <div class="secondary-panel-body">
            <p>ä»»åŠ¡å‚æ•°é…ç½®å†…å®¹...</p>
          </div>
          <div class="secondary-panel-footer"><button class="btn-cancel">å–æ¶ˆ</button><button class="btn-save">ç¡®è®¤ä¿å­˜</button></div>
        </div>

      </div>
    </section>

    <section class="panel" id="scene-display">
      <h2>ä»¿çœŸè§†å›¾</h2>
      <!-- [ä¿®æ”¹] é‡æ–°ç»„ç»‡ç»“æ„ï¼šflex å¸ƒå±€ï¼Œåˆ†ä¸ºä¸Šä¸‹ä¸¤è¡Œ -->
      <div class="panel-content" style="display: flex; flex-direction: column; gap: 10px; padding: 0; overflow: hidden;">

        <!-- ç¬¬ä¸€è¡Œï¼šä¸»è§†å›¾ (å æ®æ›´å¤šç©ºé—´) -->
        <div class="viz-placeholder" style="flex: 2; position: relative; overflow: hidden; min-height: 0;">
          <div style="position:absolute; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);">
            <!-- åœ°çƒ -->
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width: 100px; height: 100px; border-radius:50%; background: #2856c4; box-shadow: 0 0 20px #4da8da;"></div>
            <!-- è½¨é“ -->
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width: 200px; height: 200px; border-radius:50%; border: 1px dashed #555;"></div>
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width: 280px; height: 280px; border-radius:50%; border: 1px dashed #444;"></div>
            <!-- å«æ˜Ÿç‚¹ -->
            <div style="position:absolute; top:35%; left:65%; width:6px; height:6px; background:#fff; border-radius:50%; box-shadow:0 0 5px #fff;"></div>
            <div style="position:absolute; top:75%; left:35%; width:6px; height:6px; background:#e00; border-radius:50%; box-shadow:0 0 5px #e00;"></div>
          </div>
          <div style="position:absolute; top:10px; left:10px; color:rgba(255,255,255,0.7); font-size:12px;">Global Constellation View</div>
        </div>

        <!-- ç¬¬äºŒè¡Œï¼šå­è§†å›¾ (å¹¶æ’ä¸¤ä¸ª) -->
        <div style="flex: 1; display: flex; gap: 10px; min-height: 0;">

          <!-- å­è§†å›¾ 1 -->
          <div class="viz-placeholder" style="flex: 1; background-color: #000; position: relative;">
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); color: #333;">
              <!-- ç®€å•æ³¢å½¢ç¤ºæ„ -->
              <div style="display:flex; gap:2px; align-items:flex-end; height:30px;">
                <div style="width:4px; height:10px; background:#4da8da;"></div>
                <div style="width:4px; height:20px; background:#4da8da;"></div>
                <div style="width:4px; height:15px; background:#4da8da;"></div>
                <div style="width:4px; height:25px; background:#4da8da;"></div>
                <div style="width:4px; height:18px; background:#4da8da;"></div>
              </div>
            </div>
            <div style="position:absolute; top:5px; left:5px; color:rgba(255,255,255,0.7); font-size:10px;">Sensor Data</div>
          </div>

          <!-- å­è§†å›¾ 2 -->
          <div class="viz-placeholder" style="flex: 1; background-color: #000; position: relative;">
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);">
              <!-- ç®€å•é¥¼å›¾ç¤ºæ„ -->
              <div style="width: 30px; height: 30px; border-radius: 50%; background: conic-gradient(#1a73e8 0% 70%, #d93025 70% 100%);"></div>
            </div>
            <div style="position:absolute; top:5px; left:5px; color:rgba(255,255,255,0.7); font-size:10px;">Link Quality</div>
          </div>

        </div>

      </div>
    </section>

    <section class="panel" id="result-output">
      <h2 style="display: flex; align-items: center;">
        <span style="flex: 1;">é“¾è·¯çŠ¶æ€ä¿¡æ¯</span>
        <div class="button-grid" style="width: auto; gap: 5px; flex: 0 0 auto; display: flex; justify-content: center;">
          <button class="btn-tool simulation-btn" data-action="start" id="sim-start-btn" disabled>â–¶ è¿è¡Œ</button>
          <button class="btn-tool simulation-btn" data-action="pause" id="sim-pause-btn" disabled>â¸ æš‚åœ</button>
          <button class="btn-tool simulation-btn" data-action="stop" id="sim-stop-btn" disabled>â¹ åœæ­¢</button>
        </div>
        <span id="current-timeline-time" style="font-size: 12px; color: #666; font-weight: normal; flex: 1; text-align: right;">00:00:00</span>
      </h2>

      <div class="timeline-bar">
        <span class="time-mark">00:00</span>
        <input type="range" id="sim-timeline" min="0" max="100" value="0" step="0.1">
        <span class="time-mark">01:40</span> </div>

      <div class="panel-content" style="padding: 0; overflow: hidden;">
          <textarea id="link-status-log" readonly class="terminal-output">
          [ç³»ç»Ÿåˆå§‹åŒ–] ç­‰å¾…ä»¿çœŸæŒ‡ä»¤...
          [æ³¨æ„] è¯·å®Œæˆå·¦ä¾§æ‰€æœ‰ 5 é¡¹å‚æ•°é…ç½®ä»¥è§£é”ä»¿çœŸè¿è¡ŒåŠŸèƒ½ã€‚
        </textarea>
      </div>
    </section>

    <section class="panel" id="function-control">
      <h2>åŠŸèƒ½æ§åˆ¶</h2>
      <div class="panel-content">

        <div class="control-group">
          <h3>å…¨å±€æ“ä½œ</h3>
          <div class="button-grid">
            <button class="btn-tool">ğŸ“„ æ–­é“¾</button>
            <button class="btn-tool">ğŸ“‚ æŠ–åŠ¨</button>
            <button class="btn-tool">ğŸ’¾ è¯¯å·®</button>
            <button class="btn-tool btn-primary">â–¶ ç¯å¢ƒ</button>
            <button class="btn-tool">â¸ å§¿æ€</button>
            <button class="btn-tool btn-danger">â¹ è½¨é“</button>
            <button class="btn-tool">ğŸ“¤ å¯¼å‡º</button>
          </div>
        </div>

        <!-- <div class="control-group">
          <h3>æ¨¡å—é…ç½®</h3>
          <div class="module-grid">
            <button class="param-item btn-module">ä»¿çœŸæ§åˆ¶</button>
            <button class="param-item btn-module">è½¨é“æœºåŠ¨</button>
            <button class="param-item btn-module">å§¿æ€æ§åˆ¶</button>
            <button class="param-item btn-module">é“¾è·¯è®¡ç®—</button>
            <button class="param-item btn-module">å»ºé“¾å¤é“¾</button>
            <button class="param-item btn-module">ç»„ç½‘ç®¡æ§</button>
            <button class="param-item btn-module">è·¯ç”±ç­–ç•¥</button>
          </div>
        </div> -->

      </div>
    </section>

    <section class="panel" id="report-output">
      <h2>ä»¿çœŸæŠ¥å‘Š</h2>
      <div class="panel-content">
        <div class="report-content">
          <p class="log-entry"><span class="time">[14:30:01]</span> ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆã€‚</p>
          <p class="log-entry"><span class="time">[14:30:05]</span> åŠ è½½æ˜Ÿåº§é…ç½®: StarLink-Phase1ã€‚</p>
          <p class="log-entry warning"><span class="time">[14:30:12]</span> è­¦å‘Š: å«æ˜Ÿ SAT-042 è¿›å…¥åœ°å½±åŒºï¼Œèƒ½é‡å—é™ã€‚</p>
          <p class="log-entry"><span class="time">[14:30:45]</span> é“¾è·¯å»ºç«‹æˆåŠŸç‡: 98.5%ã€‚</p>
          <p class="log-entry"><span class="time">[14:31:00]</span> ç”Ÿæˆç¬¬ä¸€é˜¶æ®µä»¿çœŸæŠ¥å‘Š...</p>
        </div>
      </div>
    </section>

  </main>

  <footer class="status-bar">
    <div class="status-bar-left">
      <span>ç³»ç»ŸçŠ¶æ€: ç­‰å¾…å‚æ•°é…ç½®</span>
    </div>
    <div class="status-bar-right">
      <span>èŠ‚ç‚¹æ•°: 700</span>
      <span>æ´»è·ƒé“¾è·¯: 567</span>
      <span>ä»¿çœŸæ­¥é•¿: 1.0s</span>
    </div>
  </footer>

</div>

<script>
  /**
   * Initializes the main application logic.
   */
    // --- å…¨å±€ä»¿çœŸçŠ¶æ€ç®¡ç†ç³»ç»Ÿ ---
  const SIMULATION_STATES = {
      STOPPED: 'stopped',
      RUNNING: 'running',
      PAUSED: 'paused'
    };

  let simulationState = SIMULATION_STATES.STOPPED;
  let simulationStartTime = 0; // ä»¿çœŸå¼€å§‹çš„æ—¶é—´æˆ³
  let simulationPausedTime = 0; // æš‚åœæ—¶çš„ç´¯è®¡è¿è¡Œæ—¶é—´
  let totalPausedDuration = 0; // æ€»æš‚åœæ—¶é•¿

  // --- æ–°å¢ï¼šå‚æ•°è¾“å…¥çŠ¶æ€ç®¡ç† ---
  const paramInputStatus = {
    'panel-environment-params': false,
    'panel-orbit-params': false,
    'panel-terminal-params': false,
    'panel-device-params': false,
    'panel-task-params': false
  };

  /**
   * æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å‚æ•°éƒ½å·²å°±ç»ª
   */
  function areAllParamsReady() {
    return Object.values(paramInputStatus).every(status => status === true);
  }

  /**
   * å¼€å§‹æˆ–ç»§ç»­ä»¿çœŸ
   */
  function startSimulation() {
    // é¢å¤–æ£€æŸ¥ï¼šç¡®ä¿å‚æ•°å·²å°±ç»ª
    if (!areAllParamsReady()) {
      alert("è¯·å…ˆå®Œæˆæ‰€æœ‰å‚æ•°é…ç½®ï¼");
      return;
    }

    if (simulationState === SIMULATION_STATES.STOPPED) {
      simulationStartTime = Date.now();
      simulationPausedTime = 0;
      totalPausedDuration = 0;
      simulationState = SIMULATION_STATES.RUNNING;
      updateSimulationButtons();
      console.log('ä»¿çœŸå¼€å§‹');
    } else if (simulationState === SIMULATION_STATES.PAUSED) {
      totalPausedDuration += Date.now() - simulationPausedTime;
      simulationState = SIMULATION_STATES.RUNNING;
      updateSimulationButtons();
      console.log('ä»¿çœŸç»§ç»­');
    }
  }

  /**
   * æš‚åœä»¿çœŸ
   */
  function pauseSimulation() {
    if (simulationState === SIMULATION_STATES.RUNNING) {
      simulationPausedTime = Date.now();
      simulationState = SIMULATION_STATES.PAUSED;
      updateSimulationButtons();
      console.log('ä»¿çœŸæš‚åœ');
    }
  }

  /**
   * åœæ­¢ä»¿çœŸ
   */
  function stopSimulation() {
    if (simulationState !== SIMULATION_STATES.STOPPED) {
      simulationState = SIMULATION_STATES.STOPPED;
      updateSimulationButtons();
      console.log('ä»¿çœŸåœæ­¢');
    }
  }

  /**
   * æ›´æ–°ä»¿çœŸæ§åˆ¶æŒ‰é’®çš„çŠ¶æ€
   */
  function updateSimulationButtons() {
    const startBtn = document.getElementById('sim-start-btn');
    const pauseBtn = document.getElementById('sim-pause-btn');
    const stopBtn = document.getElementById('sim-stop-btn');

    if (!startBtn || !pauseBtn || !stopBtn) return;

    const allReady = areAllParamsReady();

    switch (simulationState) {
      case SIMULATION_STATES.STOPPED:
        // åªæœ‰å½“æ‰€æœ‰å‚æ•°éƒ½å°±ç»ªæ—¶ï¼Œè¿è¡ŒæŒ‰é’®æ‰å¯ç”¨
        startBtn.disabled = !allReady;
        startBtn.textContent = 'â–¶ è¿è¡Œ';
        startBtn.title = allReady ? "å¼€å§‹ä»¿çœŸ" : "è¯·å…ˆå®Œæˆå·¦ä¾§æ‰€æœ‰å‚æ•°é…ç½®";

        pauseBtn.disabled = true;
        stopBtn.disabled = true;
        break;
      case SIMULATION_STATES.RUNNING:
        startBtn.disabled = true;
        pauseBtn.disabled = false;
        stopBtn.disabled = false;
        break;
      case SIMULATION_STATES.PAUSED:
        startBtn.disabled = false;
        startBtn.textContent = 'â–¶ ç»§ç»­';
        pauseBtn.disabled = true;
        stopBtn.disabled = false;
        break;
    }
  }

  /**
   * è·å–å½“å‰ä»¿çœŸè¿è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
   * @returns {number} å½“å‰ä»¿çœŸæ—¶é—´
   */
  function getSimulationTime() {
    if (simulationState === SIMULATION_STATES.STOPPED) {
      return 0;
    }

    let currentTime = Date.now();
    let totalElapsed = 0;

    if (simulationState === SIMULATION_STATES.RUNNING) {
      totalElapsed = (currentTime - simulationStartTime) - totalPausedDuration;
    } else if (simulationState === SIMULATION_STATES.PAUSED) {
      totalElapsed = (simulationPausedTime - simulationStartTime) - totalPausedDuration;
    }

    return Math.max(0, totalElapsed / 1000); // è½¬æ¢ä¸ºç§’
  }

  function initializeApp() {

    // --- 2. Secondary Panel Control Logic (Fixed) ---
    const openPanelButtons = document.querySelectorAll('.param-item[data-panel-target]');

    // åˆ›å»ºå¼¹çª—é®ç½©å±‚
    let modalOverlay = document.querySelector('.modal-overlay');
    if (!modalOverlay) {
      modalOverlay = document.createElement('div');
      modalOverlay.className = 'modal-overlay';
      document.body.appendChild(modalOverlay);
    }

    /**
     * æ˜¾ç¤ºæŒ‡å®šçš„å¼¹çª—é¢æ¿
     * @param {HTMLElement} panel - è¦æ˜¾ç¤ºçš„é¢æ¿å…ƒç´ 
     */
    function openPanel(panel) {
      if (panel) {
        panel.classList.add('visible');
        modalOverlay.classList.add('visible');
        document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
      }
    }

    /**
     * éšè—æŒ‡å®šçš„å¼¹çª—é¢æ¿
     * @param {HTMLElement} panel - è¦éšè—çš„é¢æ¿å…ƒç´ 
     */
    function closePanel(panel) {
      if (panel) {
        panel.classList.remove('visible');
        modalOverlay.classList.remove('visible');
        document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
      }
    }

    // Attach listeners to open panels
    openPanelButtons.forEach(button => {
      button.addEventListener('click', () => {
        const panelId = button.dataset.panelTarget;
        if (!panelId) return;

        // Close any currently open panel before opening a new one
        document.querySelectorAll('.secondary-panel.visible').forEach(visiblePanel => {
          closePanel(visiblePanel);
        });

        const panel = document.getElementById(panelId);
        if (panel) {
          openPanel(panel);
        } else {
          console.error("Panel element not found in DOM:", panelId);
        }
      });
    });

    // Attach delegated listeners for close/save buttons
    document.addEventListener('click', (event) => {
      // Handle Close (X) or Cancel buttons within panels
      if (event.target.matches('.secondary-panel-close') || event.target.matches('.secondary-panel-footer .btn-cancel')) {
        const panel = event.target.closest('.secondary-panel');
        closePanel(panel);
      }

      // Handle clicking on modal overlay to close panel
      if (event.target === modalOverlay) {
        const visiblePanel = document.querySelector('.secondary-panel.visible');
        if (visiblePanel) {
          closePanel(visiblePanel);
        }
      }

      // Handle Save/Apply buttons within panels
      if (event.target.matches('.secondary-panel-footer .btn-apply, .secondary-panel-footer .btn-save')) {
        const panel = event.target.closest('.secondary-panel');
        if (panel) {
          // 1. æ ‡è®°è¯¥é¢æ¿çŠ¶æ€ä¸ºå·²å®Œæˆ
          if (paramInputStatus.hasOwnProperty(panel.id)) {
            paramInputStatus[panel.id] = true;

            // 2. æ›´æ–°å·¦ä¾§æŒ‰é’®çš„è§†è§‰çŠ¶æ€ (å˜ç»¿)
            const triggerBtn = document.querySelector(`.param-item[data-panel-target="${panel.id}"]`);
            if (triggerBtn) {
              triggerBtn.classList.add('confirmed');
            }
          }

          // 3. æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å‚æ•°éƒ½å·²å®Œæˆï¼Œå¦‚æœæ˜¯ï¼Œå¯ç”¨è¿è¡ŒæŒ‰é’®
          updateSimulationButtons();

          // 4. æ›´æ–°åº•éƒ¨çŠ¶æ€æ æç¤º
          const statusBarText = document.querySelector('.status-bar-left span');
          if (statusBarText) {
            if (areAllParamsReady()) {
              statusBarText.textContent = "ç³»ç»ŸçŠ¶æ€: å°±ç»ª (å‚æ•°é…ç½®å®Œæˆ)";
              statusBarText.style.color = "green";
            } else {
              const remaining = Object.values(paramInputStatus).filter(v => !v).length;
              statusBarText.textContent = `ç³»ç»ŸçŠ¶æ€: ç­‰å¾…é…ç½® (å‰©ä½™ ${remaining} é¡¹)`;
              statusBarText.style.color = "#d93025";
            }
          }

          console.log('æ•°æ®å·²ä¿å­˜!', paramInputStatus);
          closePanel(panel);
        }
      }
    });

    // Handle ESC key to close modal
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        const visiblePanel = document.querySelector('.secondary-panel.visible');
        if (visiblePanel) {
          closePanel(visiblePanel);
        }
      }
    });

    // åˆå§‹åŒ–ä»¿çœŸæ§åˆ¶æŒ‰é’®äº‹ä»¶å¤„ç†å™¨
    const simulationButtons = document.querySelectorAll('.simulation-btn');
    simulationButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const action = e.target.dataset.action;
        switch (action) {
          case 'start':
            startSimulation();
            break;
          case 'pause':
            pauseSimulation();
            break;
          case 'stop':
            stopSimulation();
            break;
        }
      });
    });

    // ç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
    updateSimulationButtons();

    // åˆå§‹åŒ–ä»¿çœŸè®¡æ—¶å™¨ã€æ—¶é—´è½´æ§åˆ¶åŠæ—¥å¿—å›æ”¾ç³»ç»Ÿ
    initializeSimulationTimer();
    console.log("App initialization complete. Events bound.");
  }

  // --- Application Entry Point ---
  document.addEventListener('DOMContentLoaded', () => {
    // Direct init since no external loading needed
    initializeApp();
  });

  // --- æ–°å¢ï¼šè¿è¡Œæ¨¡å¼åˆ‡æ¢é€»è¾‘ ---
  function setRunMode(mode) {
    const btnAuto = document.getElementById('btn-mode-auto');
    const btnStep = document.getElementById('btn-mode-step');

    if (mode === 'auto') {
      // æ ·å¼åˆ‡æ¢ï¼šé«˜äº®è‡ªåŠ¨ï¼Œç°æ‰å•æ­¥
      btnAuto.classList.add('btn-primary');
      btnStep.classList.remove('btn-primary');
      console.log("å·²åˆ‡æ¢è‡³ï¼šè‡ªåŠ¨è¿è¡Œæ¨¡å¼");
      // TODO: è¿™é‡Œæ·»åŠ è‡ªåŠ¨è¿è¡Œçš„é€»è¾‘è°ƒç”¨
    } else {
      // æ ·å¼åˆ‡æ¢ï¼šé«˜äº®å•æ­¥ï¼Œç°æ‰è‡ªåŠ¨
      btnStep.classList.add('btn-primary');
      btnAuto.classList.remove('btn-primary');
      console.log("å·²åˆ‡æ¢è‡³ï¼šå•é˜¶æ®µè¿è¡Œæ¨¡å¼");
      // TODO: è¿™é‡Œæ·»åŠ å•æ­¥è¿è¡Œçš„é€»è¾‘è°ƒç”¨
    }
  }

  /**
   * åˆå§‹åŒ–ä»¿çœŸè®¡æ—¶å™¨ã€æ—¶é—´è½´æ§åˆ¶åŠæ—¥å¿—å›æ”¾ç³»ç»Ÿ
   */
  function initializeSimulationTimer() {
    // --- DOM å…ƒç´ è·å– ---
    const timeValueElement = document.querySelector('#simulation-time .value span');
    const timelineSlider = document.getElementById('sim-timeline');
    const timelineTimeDisplay = document.getElementById('current-timeline-time');
    const logBox = document.getElementById('link-status-log');

    if (!timeValueElement || !timelineSlider || !logBox) {
      console.warn("æœªæ‰¾åˆ°æ—¶é—´è½´ç›¸å…³å…ƒç´ ï¼Œè·³è¿‡åˆå§‹åŒ–");
      return;
    }

    // --- çŠ¶æ€å˜é‡ ---
    let displayTime = 0.0; // å½“å‰æ˜¾ç¤ºæ—¶é—´ (ç§’ï¼Œç”±æ»‘å—æ§åˆ¶)
    const maxDuration = 100.0; // ä»¿çœŸæ€»æ—¶é•¿ (å¯¹åº”æ»‘å—æœ€å¤§å€¼)
    let isDragging = false; // æ ‡è®°ç”¨æˆ·æ˜¯å¦æ­£åœ¨æ‹–æ‹½æ»‘å—

    // é¢„è®¾ä¸€äº›æ—¥å¿—æ•°æ®ï¼Œæ¨¡æ‹ŸçœŸå®çš„å†å²è®°å½•
    // ç»“æ„: { time: å‘ç”Ÿæ—¶é—´(ç§’), msg: æ—¥å¿—å†…å®¹ }
    let logHistory = [{
      time: 0.0,
      msg: "[ç³»ç»Ÿåˆå§‹åŒ–] ç­‰å¾…ä»¿çœŸæŒ‡ä»¤..."
    },
      {
        time: 0.1,
        msg: "[00:00:00] ä»¿çœŸå¼€å§‹ã€‚"
      },
      {
        time: 1.5,
        msg: "[00:00:01] åŠ è½½æ˜Ÿåº§é…ç½® StarLink-Phase1... å®Œæˆã€‚"
      },
      {
        time: 3.2,
        msg: "[00:00:03] è®¡ç®—åˆå§‹åŒ–è½¨é“å‚æ•°..."
      },
      {
        time: 5.5,
        msg: "[00:00:05] æ­£åœ¨æ‰«æå¯è§é“¾è·¯..."
      },
      {
        time: 8.0,
        msg: "[00:00:08] é“¾è·¯ L-001 (SAT-01 <-> SAT-02) å»ºç«‹æˆåŠŸ (SNR: 12.4dB)."
      },
      {
        time: 9.2,
        msg: "[00:00:09] é“¾è·¯ L-005 (SAT-03 <-> SAT-04) å»ºç«‹æˆåŠŸ (SNR: 11.8dB)."
      },
      {
        time: 12.5,
        msg: "[00:00:12] è­¦å‘Š: SAT-05 èƒ½é‡ä¸è¶³ï¼Œè¿›å…¥çœç”µæ¨¡å¼ã€‚"
      },
      {
        time: 15.0,
        msg: "[00:00:15] æ‹“æ‰‘æ›´æ–°: 3 æ¡é“¾è·¯å› åœ°çƒé®æŒ¡æ–­å¼€ã€‚"
      },
      {
        time: 22.1,
        msg: "[00:00:22] æ”¶åˆ°åœ°é¢ç«™ G-01 ä¸Šè¡ŒæŒ‡ä»¤ã€‚"
      },
      {
        time: 35.0,
        msg: "[00:00:35] è·¯ç”±è¡¨é‡æ”¶æ•›å®Œæˆã€‚"
      },
      {
        time: 48.0,
        msg: "[00:00:48] é“¾è·¯ L-089 (SAT-12 <-> SAT-13) è¯¯ç ç‡ä¸Šå‡ (BER: 1.2e-4)ã€‚"
      },
      {
        time: 60.0,
        msg: "[00:01:00] è¿›å…¥ä¸‹ä¸€ä»¿çœŸå‘¨æœŸã€‚"
      },
      {
        time: 75.5,
        msg: "[00:01:15] å«æ˜Ÿ SAT-42 å®Œæˆå§¿æ€æœºåŠ¨ã€‚"
      },
      {
        time: 90.0,
        msg: "[00:01:30] ä»¿çœŸæ•°æ®è‡ªåŠ¨ä¿å­˜ã€‚"
      }
    ];

    // --- æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---

    /**
     * æ›´æ–°æ‰€æœ‰UIæ˜¾ç¤ºï¼ˆæ—¶é—´æ•°å­—ã€æ»‘å—ä½ç½®ã€æ—¥å¿—å†…å®¹ï¼‰
     */
    function updateUI() {
      const simTime = getSimulationTime();

      // A. æ›´æ–°displayTimeè·Ÿéšä»¿çœŸæ—¶é—´ï¼ˆä»…åœ¨è¿è¡ŒçŠ¶æ€ï¼‰
      if (simulationState === SIMULATION_STATES.RUNNING && !isDragging) {
        displayTime = simTime;
      }

      // B. æ›´æ–°æ»‘å—ä½ç½® (å¦‚æœä¸æ˜¯ç”¨æˆ·æ­£åœ¨æ‹–æ‹½ä¸­)
      if (!isDragging) {
        timelineSlider.value = displayTime;
      }

      // C. æ›´æ–°å·¦ä¸Šè§’å¤§æ•°å­—æ—¶é—´ - æ˜¾ç¤ºä»¿çœŸè¿è¡Œæ—¶é—´
      timeValueElement.textContent = simTime.toFixed(1);

      // D. æ›´æ–°æ ‡é¢˜æ æ—è¾¹çš„ HH:MM:SS æ—¶é—´ - æ˜¾ç¤ºæ˜¾ç¤ºæ—¶é—´ï¼ˆå¯ç”±æ»‘å—æ§åˆ¶ï¼‰
      if (timelineTimeDisplay) {
        const date = new Date(null);
        date.setSeconds(displayTime);
        // å¤„ç† ISO å­—ç¬¦ä¸²æˆªå–ï¼Œæ˜¾ç¤º HH:mm:ss
        const timeString = date.toISOString().substr(11, 8);
        timelineTimeDisplay.textContent = timeString;
      }

      // E. æ›´æ–°æ—¥å¿— (æ ¹æ®æ˜¾ç¤ºæ—¶é—´æ˜¾ç¤ºç›¸åº”çš„æ—¥å¿—è®°å½•)
      renderLogs();
    }

    /**
     * æ¸²æŸ“æ—¥å¿—å†…å®¹ï¼Œæ ¹æ®æ˜¾ç¤ºæ—¶é—´æ˜¾ç¤ºç›¸åº”çš„æ—¥å¿—è®°å½•
     */
    function renderLogs() {
      // è¿‡æ»¤å‡ºæ‰€æœ‰å‘ç”Ÿæ—¶é—´ <= æ˜¾ç¤ºæ—¶é—´çš„æ—¥å¿—
      const visibleLogs = logHistory.filter(log => log.time <= displayTime);

      // æ‹¼æ¥æ–‡æœ¬
      const logText = visibleLogs.map(log => log.msg).join('\n');

      // åªæœ‰å½“å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶æ‰æ›´æ–° DOMï¼Œé¿å…å…‰æ ‡é—ªçƒ
      if (logBox.value !== logText) {
        logBox.value = logText;
        logBox.scrollTop = logBox.scrollHeight; // ä¿æŒæ»šåŠ¨åœ¨åº•éƒ¨
      }
    }

    /**
     * åŠ¨æ€ç”Ÿæˆéšæœºæ—¥å¿—ï¼Œè®©ä»¿çœŸçœ‹èµ·æ¥æ›´åŠ çœŸå®
     */
    function generateRandomLog() {
      if (Math.random() > 0.98) { // 2% çš„æ¦‚ç‡ç”Ÿæˆæ–°æ—¥å¿—
        const simTime = getSimulationTime();
        const satId = Math.floor(Math.random() * 50) + 1;
        const snr = (Math.random() * 10 + 5).toFixed(1);
        const nowStr = new Date(simTime * 1000).toISOString().substr(11, 8);

        const newLog = {
          time: simTime, // è®°å½•äº§ç”Ÿæ—¶é—´
          msg: `[${nowStr}] å®æ—¶ç›‘æµ‹: SAT-${satId} ä¿¡å·æ³¢åŠ¨ (SNR: ${snr}dB)`
        };

        logHistory.push(newLog); // åŠ å…¥å†å²è®°å½•
      }
    }

    // --- äº‹ä»¶ç›‘å¬ ---

    // 1. æ»‘å— "input" äº‹ä»¶ï¼šæ‹–æ‹½è¿‡ç¨‹ä¸­å®æ—¶è§¦å‘ (å®ç°å¿«è¿›/å¿«é€€é¢„è§ˆ)
    timelineSlider.addEventListener('input', (e) => {
      isDragging = true; // æ ‡è®°æ­£åœ¨æ‹–æ‹½
      displayTime = parseFloat(e.target.value); // å¼ºåˆ¶æ›´æ–°æ˜¾ç¤ºæ—¶é—´ä¸ºæ»‘å—å€¼
      updateUI(); // ç«‹å³åˆ·æ–° UI (åŒ…æ‹¬æ—¥å¿—å›æ»š)
    });

    // 2. æ»‘å— "change" äº‹ä»¶ï¼šæ‹–æ‹½ç»“æŸæ¾å¼€é¼ æ ‡æ—¶è§¦å‘
    timelineSlider.addEventListener('change', (e) => {
      isDragging = false; // ç»“æŸæ‹–æ‹½çŠ¶æ€
      displayTime = parseFloat(e.target.value);
      // æ­¤æ—¶è‡ªåŠ¨è®¡æ—¶å™¨ä¼šæ¥ç®¡
    });

    // 3. é¼ æ ‡æŒ‰ä¸‹æš‚åœï¼Œæ¾å¼€ç»§ç»­ (ä¼˜åŒ–ä½“éªŒ)
    timelineSlider.addEventListener('mousedown', () => {
      isDragging = true;
    });
    timelineSlider.addEventListener('mouseup', () => {
      isDragging = false;
    });
    // å…¼å®¹è§¦æ‘¸å±
    timelineSlider.addEventListener('touchstart', () => {
      isDragging = true;
    });
    timelineSlider.addEventListener('touchend', () => {
      isDragging = false;
    });

    // --- å¯åŠ¨è‡ªåŠ¨æ›´æ–°å¾ªç¯ (100ms ä¸€æ¬¡) ---
    setInterval(() => {
      // åªæœ‰å½“éæ‹–æ‹½çŠ¶æ€æ—¶ï¼Œæ‰æ›´æ–°æ˜¾ç¤ºæ—¶é—´ä»¥è·Ÿéšä»¿çœŸæ—¶é—´
      if (!isDragging) {
        const simTime = getSimulationTime();
        // å¦‚æœä»¿çœŸæ­£åœ¨è¿è¡Œï¼Œæ›´æ–°æ˜¾ç¤ºæ—¶é—´ä»¥è·Ÿéšä»¿çœŸæ—¶é—´
        if (simulationState === SIMULATION_STATES.RUNNING) {
          displayTime = simTime;
        }
        // å¦‚æœä»¿çœŸå·²åœæ­¢æˆ–æš‚åœï¼Œä¿æŒå½“å‰æ˜¾ç¤ºæ—¶é—´ä¸å˜
      }

      // åªæœ‰å½“ä»¿çœŸæ­£åœ¨è¿è¡Œæ—¶ï¼Œæ‰ç”Ÿæˆæ–°çš„æ—¥å¿—
      if (simulationState === SIMULATION_STATES.RUNNING) {
        generateRandomLog();
      }

      // å§‹ç»ˆæ›´æ–°UIæ˜¾ç¤º
      updateUI();
    }, 100);
  }
</script>

</body>

</html>
